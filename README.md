# ğŸ’»:TECHNOVA:ğŸ’»
## ë¬¼ë¥˜ ê´€ë¦¬ ë° ë°°ì†¡ ì‹œìŠ¤í…œì„ ìœ„í•œ MSA ê¸°ë°˜ í”Œë«í¼ ê°œë°œ
- í”„ë¡œì íŠ¸ ì†Œê°œ <br>
  Â° B2B ë¬¼ë¥˜ ê´€ë¦¬ ë° ë°°ì†¡ ì‹œìŠ¤í…œ<br>
  Â° MSA(Microservice Architecture)ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì„¤ê³„<br>
  Â° ë¬¼ë¥˜ ì‹œìŠ¤í…œì˜ ë””ì§€í„¸í™”<br>
  Â° íš¨ìœ¨ì  ë°°ì†¡ í”„ë¡œì„¸ìŠ¤

## íŒ€ì› êµ¬ì„± ë° ë‹´ë‹¹ ë¶€ë¶„
<div align="center">

|         ì¡°ìš°ì„         |                 í•œë¯¸ìˆ˜                 |              ì¡°ì°½í˜„               | ì‹ ì§„ìš° |
|:-------------------:|:-----------------------------------:|:------------------------------:|:---:|
| í—ˆë¸Œ ê´€ë¦¬,í—ˆë¸Œ ê°„ ì´ë™ì •ë³´, AI | ë°°ì†¡ ê´€ë¦¬,ë°°ì†¡ ê²½ë¡œ ê¸°ë¡ ê´€ë¦¬,ë°°ì†¡ ë‹´ë‹¹ì ê´€ë¦¬, ì‚¬ìš©ì ê´€ë¦¬ | ì—…ì²´ ê´€ë¦¬, ìƒí’ˆ ê´€ë¦¬, ì£¼ë¬¸ ê´€ë¦¬, ë°°ì†¡ ë‹´ë‹¹ì ë°°ì • ë¡œì§ |  -  |
</div>


## 1. ê°œë°œ í™˜ê²½
- **í”„ë¡œì íŠ¸ ê°œë°œ í™˜ê²½** : IntelliJ
- **Backend**: Java 17, Spring Boot 3.x
- **Database**: PostgreSQL
- **Build Tool**: Gradle
- **API ì„¤ê³„**: RESTful API
- **ì„œë¹„ìŠ¤ íƒìƒ‰**: Spring Cloud Eureka
- **API Gateway**: Spring Cloud Gateway
- **ë³´ì•ˆ**: Spring Security, JWT, BCrypt
- **ë²„ì „ ê´€ë¦¬** : Git
- **í˜‘ì—… íˆ´** : Slack, Notion

## 2. ê°œë°œ ê¸°ê°„ ë° ì‘ì—… ê´€ë¦¬
- 24-12-05 ~ 24-12-17(ì´ 13ì¼)

## 3. ì•„í‚¤í…ì³
![ì¸í”„ë¼](https://github.com/user-attachments/assets/a8bba90b-c831-42cc-b86b-944a7ebe858c)

## 4. í…Œì´ë¸” ëª…ì„¸ì„œ
https://teamsparta.notion.site/5b791b85f72847458f53089b0064f929

## 5. ERD
<img width="852" alt="erd" src="https://github.com/user-attachments/assets/8e901a19-e19c-4c8d-b0ac-f9ba83ae5a15" />

## 6. API ëª…ì„¸ì„œ
https://teamsparta.notion.site/API-57d139b62887422283c4030f11d26af2
## íŠ¸ëŸ¬ë¸” ìŠˆíŒ…

### í•œë¯¸ìˆ˜
### ê²½ìœ ì§€ ì •ë³´ ë¶€ì¡± ë˜ëŠ” ì—†ìŒìœ¼ë¡œ ìˆœì„œ ê²°ì • ë¶ˆê°€

- ë¬¸ì œì •ì˜
  1. ì—…ì²´ ë°°ì†¡ ë‹´ë‹¹ìê°€ ë°©ë¬¸í•´ì•¼ í•˜ëŠ” ì¥ì†Œë“¤ì˜ ìœ„ê²½ë„ ê°’ì„ ê¸°ë°˜ìœ¼ë¡œ ê²½ìœ ì§€ ìˆœì„œë¥¼ ì •í•˜ë ¤ AIì— ìš”ì²­ ì‹œ, ì£¼ì–´ì§„ ì •ë³´ê°€ ë¶€ì¡±í•´ ì‘ë‹µ ë¶ˆê°€ëŠ¥ ë©”ì‹œì§€ê°€ ë°œìƒ
  2. ê²½ìœ ì§€ê°€ ì—†ì„ ì‹œ ì˜ˆì™¸ê°€ ë°œìƒ
- í•´ê²°ê³¼ì •

  ì–´ë–¤ ì •ë³´ë¥¼ ì£¼ì–´ì•¼ AIê°€ ëŒ€ë‹µí•  ìˆ˜ ìˆëŠ”ì§€, ê·¸ë¦¬ê³  ê²½ìœ ì§€ê°€ ì—†ì„ ì‹œ AIì—ê²Œ ì–´ë–¤ ê°’ì„ ìš”ì²­í•˜ê³  ì‘ë‹µì„ ë°›ì„ì§€ ê²°ì •.

  1. ë°©ë¬¸í•´ì•¼ í•˜ëŠ” ëª¨ë“  ì¥ì†Œë¥¼ |ë¡œ êµ¬ë¶„í•´ í•œ ë¬¸ìì—´ë¡œ ìƒì„±.
  2. AIì—ê²Œ ìµœëŒ€í•œ ìƒì„¸í•˜ê²Œ ë©”ì‹œì§€ë¥¼ ìš”ì²­.
  3. ê²½ìœ ì§€ ì—†ì´ ë°©ë¬¸ ì¥ì†Œ ë‘ ê³³ì¼ ë•Œ ëŒ€ì²˜ ë°©ì•ˆë„ í¬í•¨, ê²½ìœ ì§€ ìœ ë¬´ì— ê´€ê³„ì—†ì´ ì‘ë‹µ ë°˜í™˜.

    ```java
        private List<Integer> getWaypointsOrder(List<LocationData> locationDatas) {
            String waypointsString = buildWaypointsString(locationDatas);
    
            String requestBody = "ë‚´ê°€ ë‹¤ìŒê³¼ ê°™ì´ ì—¬ëŸ¬ ì¥ì†Œë“¤ì„ ê²½ë„,ìœ„ë„ë¡œ ë³´ëƒˆì–´. ê° ì¥ì†ŒëŠ” |ë¡œ êµ¬ë¶„ë¼. ì°¨ë¡œ ì´ë™í–ˆì„ ë•Œ ê°€ì¥ ë¹ ë¥´ê²Œ ì´ë™í•  ìˆ˜ ìˆì„ì§€ ìˆœì„œë¥¼ ì•Œë ¤ì¤˜. ë§Œì•½ ë‚´ê°€ ì¤€ ì¥ì†Œê°€ ë‘ê°œë¼ë©´ ì„ì˜ì ìœ¼ë¡œ ë„ˆê°€ 1ë²ˆ 2ë²ˆì„ ì •í•´. ë‹¤ë¥¸ ë¶€ê°€ ì„¤ëª…ì—†ì´ ë‹¤ìŒê³¼ ê°™ì´ ë°©ë¬¸ ìˆœì„œë§Œ ì‘ë‹µí•´ì¤˜, ê·¸ë¦¬ê³  ê° ë°©ë¬¸ ìˆœì„œëŠ” ,ë¡œ êµ¬ë¶„í•´ì¤˜. ì˜ˆì‹œ ë³´ì—¬ì¤„ê²Œ. 1,2,3,5,4" + waypointsString;
    
            String response = googleApiService.generateContent(requestBody);
    
            return parseOptimizedOrder(response);
        }
    ```

- ê²°ê³¼

  AIê°€ ê²½ìœ ì§€ê°€ ì—†ê±°ë‚˜ ìˆëŠ” ê²½ìš° ëª¨ë‘ ì‘ë‹µ ê²°ê³¼ ë°˜í™˜
  AIê°€ ì‘ë‹µí•œ ê²½ë¡œì˜ ìˆœì„œë¥¼ Integer íƒ€ì…ì˜ ë¦¬ìŠ¤íŠ¸ë¡œ ê°€ê³µí•´ ì´í›„ ê²½ìœ ì§€ ì§€ì •ì— ì´ìš©.

    ```java
    public List<Integer> parseOptimizedOrder(String jsonResponse) {
            try {
                ObjectMapper objectMapper = new ObjectMapper();
                JsonNode rootNode = objectMapper.readTree(jsonResponse);
    
                String text = rootNode.at("/candidates/0/content/parts/0/text").asText().trim();
    
                return Arrays.stream(text.split(","))
                        .map(String::trim)
                        .map(Integer::parseInt)
                        .collect(Collectors.toList());
            } catch (Exception e) {
                throw new RuntimeException("Failed to parse optimized order from response text", e);
            }
        }
    ```


### ì£¼ë¬¸ ìƒì„±ê³¼ ë°°ì†¡ ìë™ ìˆ˜í–‰ êµ¬ë¶„ ë¬¸ì œ í•´ê²°

- ë¬¸ì œì •ì˜
  1. ë°°ì†¡ ìƒì„± ë¡œì§ì€ ì£¼ë¬¸ì´ ìƒì„±ë˜ë©´ ìë™ìœ¼ë¡œ ìˆ˜í–‰ë˜ë©°, ê¶Œí•œì€ MASTERë§Œ ë¶€ì—¬ë¨.
  2. ì£¼ë¬¸ì€ MASTERê°€ ì•„ë‹ˆì–´ë„ ìƒì„± ê°€ëŠ¥.
  3. ìƒì„±ê³¼ ìë™ ìˆ˜í–‰ì„ ì–´ë–»ê²Œ êµ¬ë¶„í•´ì•¼ í•˜ë‚˜?
- í•´ê²°ê³¼ì •

  X-Order-Origin ì»¤ìŠ¤í…€ í—¤ë” ê°’ì„ ì •ì˜í•´ API ìš”ì²­ì— í—¤ë” ê°’ì´ ìˆìœ¼ë©´ ì£¼ë¬¸ ì„œë¹„ìŠ¤ë‚˜ ë‹¤ë¥¸ ì„œë¹„ìŠ¤ì—ì„œ í˜¸ì¶œí–ˆë‹¤ê³  ê²°ì •.

  API ìš”ì²­ì— í—¤ë” ê°’ì´ ì—†ìœ¼ë©´ ë§ˆìŠ¤í„° ê¶Œí•œì„ ì†Œìœ í•œ ì‚¬ìš©ìê°€ ìš”ì²­í•œ ê²ƒì¸ì§€ ê²€ì¦.

    ```java
    @PostMapping
    public ResponseEntity<ApiResponseDto<UUID>> createDelivery(
    	@RequestBody DeliveryRequest request,
      @RequestHeader(value = "X-Order-Origin", required = false) String orderOriginToken,
      @RequestHeader(value = "X-User-Id", required = true) UUID userId,
      @RequestHeader(value = "X-Role", required = true) String role
    ) {
    	UUID deliveryId = deliveryService.createDelivery(request.toDTO(), orderOriginToken);
      return ResponseEntity.ok(ApiResponseDto.success("Delivery created successfully", deliveryId));
    }
    ```

    ```java
    createDelivery(dto, "orderApp-001", userId, role);
    ```

- ê²°ê³¼

  X-Order-Origin í—¤ë”ê°€ ìˆìœ¼ë©´ ì™¸ë¶€ í˜¸ì¶œë¡œ ì²˜ë¦¬ë˜ê³ , í—¤ë”ê°€ ì—†ìœ¼ë©´ ë§ˆìŠ¤í„° ê¶Œí•œì„ ê°€ì§„ ì‚¬ìš©ìê°€ ìš”ì²­í•œ ê²ƒìœ¼ë¡œ ê°„ì£¼í•˜ì—¬ ìë™ ìˆ˜í–‰ ì—¬ë¶€ë¥¼ ê²°ì •.

### ì¡°ì°½í˜„
### **í†µì‹  í˜¸ì¶œ**

**ë¬¸ì œì :**  ê° ì„œë¹„ìŠ¤ ê°„ í†µì‹  í˜¸ì¶œì€ ì´ë£¨ì–´ ì¡ŒëŠ”ë° ì‹¤ì œ ì•„ì´ë”” ê°’ í™•ì¸í•˜ëŠ”ë° ì—ëŸ¬ ë°œìƒ<br>
**ì›ì¸** : ì‘ë‹µ í˜•ì‹ ë˜ëŠ” ë°ì´í„° íƒ€ì…ì´ ë‹¤ë¥¸ í˜•íƒœë¼ì„œ ê²€ì¦ ì‹¤íŒ¨ ë°œìƒ.<br>
**í•´ê²° :** ì‘ë‹µ í˜•ì‹ ë˜ëŠ” ë°ì´í„° íƒ€ì…ì„ í†µì¼í•˜ì—¬ ë¬¸ì œë¥¼ í•´ê²°<br>

```java
// ClientAPiResponse í™œìš©í•˜ì—¬ íƒ€ì… í†µì¼í•˜ì—¬ ë¬¸ì œë¥¼ í•´ê²°
@FeignClient(name = "hub-service", path = "/api/v1/hubs")
public interface HubServiceClient {

    @GetMapping("/{hubId}")
    ClientApiResponse<ApiResponseDto<HubResponse>> getHub(@PathVariable("hubId") UUID hubId); // í—ˆë¸Œ IDë¡œ ì¡°íšŒ

}

```

### **ë¬´í•œ API í˜¸ì¶œ**

**ë¬¸ì œì ** : ë¬´í•œ API í˜¸ì¶œì´ ë°œìƒí•˜ì—¬ ì„œë¹„ìŠ¤ ì¥ì•  ì´ˆë˜ (ë©”ëª¨ë¦¬ ê³µê°„ì´ ë¶€ì¡±í•  ë•Œê¹Œì§€ ë¬´í•œ í˜¸ì¶œ)

```java
// ë‹¤ìŒê³¼ ê°™ì€ í˜•ì‹ìœ¼ë¡œ ë¬´í•œ í˜¸ì¶œ
/api/v1/api/v1/api/v1/api/v1/api/v1/api/v1/api/v1/api/v1/api/v1/api/v1/
api/v1/api/v1/api/v1/api/v1/api/v1/api/v1/api/v1/api/v1/api/v1/api/v1/api/v1
/api/v1/api/v1/api/v1/api/v1/api/v1/api/v1/ì—”ë“œí¬ì¸íŠ¸
```

**ì›ì¸** : ì˜ˆì™¸ ë°œìƒí•˜ë©´  globalExceptionHandlerì—ì„œ ê³µí†µ ì˜ˆì™¸ ì²˜ë¦¬ê°€ ì´ë£¨ì–´ì ¸ì•¼ í•˜ëŠ”ë° í•´ë‹¹ ì½”ë“œì—ì„œ ë°˜í™˜ì´ ì´ë£¨ì–´ì§€ì§€ ì•ŠìŒ

```java
// ë‹¤ìŒê³¼ ê°™ì´ ì‘ì„±í•˜ì—¬ ì—ëŸ¬ ë°œìƒ
@ControllerAdvice
public ApiResponseDto<Void> handleIllegalArgumentException(IllegalArgumentException ex) {
        log.error("IllegalArgumentException: {}", ex.getMessage());
        return ApiResponseDto.<Void>builder()
                .statusCode(HttpStatus.BAD_REQUEST.value())
                .statusMessage(HttpStatus.BAD_REQUEST.getReasonPhrase())
                .message(ex.getMessage())
                .build();
    }
    
    // ë‹¤ë¥¸ ì½”ë“œ
```

**í•´ê²°** : (1.)  ë˜ëŠ” (2.) ë°©ì‹ìœ¼ë¡œ í•´ê²°ì´ ê°€ëŠ¥í•œë° (2.)ìœ¼ë¡œ í•´ê²°í•¨
```java
// í•´ê²°ë°©ë²•
// 1.ResponseEntity í˜•ì‹ìœ¼ë¡œ ì‘ë‹µ ì²˜ë¦¬ + @controlleradvice ì‚¬ìš©
// public ResponseEntity<ApiResponeDto<void>> ~ + @ControllerAdvice

// 2. ApiResponseë¼ëŠ” ê³µí†µ ì‘ë‹µìœ¼ë¡œ ì²˜ë¦¬ í•  ê²½ìš° + @restcontrolleradvice ì‚¬ìš©
//
@RestControllerAdvice
@Slf4j
public class GlobalExceptionHandler {

    @ExceptionHandler(IllegalArgumentException.class)
    @ResponseStatus(HttpStatus.BAD_REQUEST)
    public ApiResponseDto<Void> handleIllegalArgumentException(IllegalArgumentException ex) {
        log.error("IllegalArgumentException: {}", ex.getMessage());
        return ApiResponseDto.<Void>builder()
                .statusCode(HttpStatus.BAD_REQUEST.value())
                .statusMessage(HttpStatus.BAD_REQUEST.getReasonPhrase())
                .message(ex.getMessage())
                .build();
    }
    
    // ë‹¤ë¥¸ ì½”ë“œ
```

### ì¡°ìš°ì„

### QueryDSLì„ í™œìš©í•œ ì»¤ìŠ¤í…€ ë©”ì„œë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ëŠ” ë¬¸ì œ

ë¬¸ì œ ìƒí™©:

`HubRepository` ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•´ `searchHubs` ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ë ¤ê³  í–ˆì„ ë•Œ, í•´ë‹¹ ë©”ì„œë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ë‹¤ëŠ” ì˜ˆì™¸ê°€ ë°œìƒ

- ê¸°ì¡´ì˜ `HubRepository`ëŠ” `JpaRepository`ì™€ `HubRepositoryCustom`ë¥¼ í•¨ê»˜ ìƒì†í–ˆì§€ë§Œ, Spring Data JPAëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ì»¤ìŠ¤í…€ ë©”ì„œë“œë¥¼ ì¸ì‹í•˜ê¸° ìœ„í•´ íŠ¹ì • ê·œì¹™ì„ ìš”êµ¬
- `JpaRepository` ì¸í„°í˜ì´ìŠ¤ì™€ ì»¤ìŠ¤í…€ ë¦¬í¬ì§€í† ë¦¬ ë©”ì„œë“œê°€ ëª…í™•íˆ ë¶„ë¦¬ë˜ì§€ ì•Šì•„ Springì´ `searchHubs` ë©”ì„œë“œë¥¼ ì œëŒ€ë¡œ ì¸ì‹í•˜ì§€ ëª»í•œ ê²ƒìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤.

í•´ê²°ë°©ë²•:

- **ë¦¬í¬ì§€í† ë¦¬ êµ¬ì¡° ì¬ì„¤ê³„**
  - `HubRepository`ë¥¼ ê¸°ë³¸ ê¸°ëŠ¥ì„ ë‹´ë‹¹í•˜ëŠ” ì¸í„°í˜ì´ìŠ¤ë¡œ ë‹¨ìˆœí™”í–ˆìŠµë‹ˆë‹¤.
  - `HubJpaRepository`ëŠ” `JpaRepository`ë¥¼ ìƒì†ë°›ì•„ Spring Data JPAì˜ ê¸°ë³¸ CRUD ê¸°ëŠ¥ì„ ì œê³µí•˜ë„ë¡ í–ˆìŠµë‹ˆë‹¤.
  - `HubRepositoryCustom` ì¸í„°í˜ì´ìŠ¤ì™€ `HubRepositoryCustomImpl` í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´ QueryDSLì„ í™œìš©í•œ ì»¤ìŠ¤í…€ ë©”ì„œë“œë¥¼ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.
- **ë¦¬í¬ì§€í† ë¦¬ êµ¬í˜„ í´ë˜ìŠ¤ ì‘ì„±**
  - `HubRepositoryImpl`ì—ì„œ ê¸°ë³¸ ë¦¬í¬ì§€í† ë¦¬ ê¸°ëŠ¥(`save`, `findById` ë“±)ì„ ìœ„ì„í•˜ë„ë¡ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.
  - `HubRepositoryCustomImpl`ì—ì„œ `searchHubs` ë©”ì„œë“œë¥¼ QueryDSLì„ í™œìš©í•˜ì—¬ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.

ìµœì¢… ì½”ë“œ:

```java
public interface HubRepository {
void save(Hub hub);
...
}

@Repository
@RequiredArgsConstructor
public class HubRepositoryImpl implements HubRepository {

  private final HubJpaRepository hubJpaRepository;

  @Override
  public void save(Hub hub) {
    hubJpaRepository.save(hub);
  }
...
}

public interface HubJpaRepository extends JpaRepository<Hub, UUID> {
  Optional<Hub> findByHubIdAndIsDeletedFalse(UUID hubId);
}

public interface HubRepositoryCustom {
Page<Hub> searchHubs(String role, HubSearchDto hubSearchDto, Pageable pageable);
  ...
}

@Repository
@RequiredArgsConstructor
public class HubRepositoryCustomImpl implements HubRepositoryCustom {
@Override
  public Page<Hub> searchHubs(String role, HubSearchDto hubSearchDto, Pageable pageable) {
}
...
}

```

### í•œê¸€ ì…ë ¥ ì¸ì½”ë”© ë¬¸ì œ

ë¬¸ì œ ìƒí™©:

`findIntermediateHub` ë©”ì„œë“œì—ì„œ `equals` í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ `departureHubName`ê³¼ `regionAdjacency` ë§µì˜ ê°’ì„ ë¹„êµí–ˆì„ ë•Œ, í•œê¸€ ë¬¸ìì—´ ë¹„êµì—ì„œ ë¬¸ì œê°€ ë°œìƒ. ë‘ ë¬¸ìì—´ì´ ë™ì¼í•´ ë³´ì˜€ìŒì—ë„ ë¹„êµê°€ ì‹¤íŒ¨í•˜ëŠ” ìƒí™©ì´ ë°œìƒ

```java
public String findIntermediateHub(String departureHubName) {
   ...
      for (String value : values) {
        if (value.equals(departureHubName)) { // ë¬¸ì œ ë°œìƒ
     ...
  }
```

í•´ê²° ë°©ë²•:
ì…ë ¥ ë¬¸ìì—´(`departureHubName`)ì„ ë¹„êµ ì „ì— ì¼ê´€ëœ ìœ ë‹ˆì½”ë“œ í˜•ì‹(NFC)ìœ¼ë¡œ ì •ê·œí™”í•˜ë„ë¡ ìˆ˜ì •
ìë°” í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ `Normalizer` í´ë˜ìŠ¤ë¥¼ í™œìš©í•˜ì—¬ ë¬¸ìì—´ì„ ì •ê·œí™”í•˜ëŠ” `normalizeString` ë©”ì„œë“œë¥¼ ì¶”ê°€

```java
private static String normalizeString(String str) {
    return Normalizer.normalize(str, Normalizer.Form.NFC);
}

public String findIntermediateHub(String departureHubName) {
    departureHubName = normalizeString(departureHubName.trim());

    if (regionAdjacency.containsKey(departureHubName)) {
        return departureHubName;
    }

    for (String key : regionAdjacency.keySet()) {
        List<String> values = regionAdjacency.get(key);

        for (String value : values) {
            if (value.equals(departureHubName)) {
                return key;
            }
        }
    }
    throw new IllegalArgumentException("ë°ì´í„°ê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
}

```



